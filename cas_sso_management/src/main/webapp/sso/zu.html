
	<body class="hold-transition skin-blue sidebar-mini fixed body-enterprise ">
		
		<!--左侧导航-->
		
		<!--右侧主体-->
			<!-- Content Header (Page header) -->
			<!-- Main content -->
			<div class="content">
				<div class="bs-example bs-example-tabs">

					<div class="row breadcrumb-box">
						<ol class="breadcrumb">
							<li class="active">
								<a><i class="fa fa-map-signs icon-primary"></i>账户及组</a>
							</li>
						</ol>

					</div>

					<div id="myTabContent" class="tab-content ud-list-all">
						<div role="tabpanel" class="tab-pane fade in active" id="home" aria-labelledby="home-tab">
							<div class="row ud-two-col-full-height">
								<div class="col-md-3" ouUuid="2d9ccc8515286b8f14f6cb4d6faad6ebptu9ceiUpAK">
									<!--IE7 z-index  style="z-index:3;" -->
									<div class="box box-border-top box-outree" id="stScrollerTargetMiddleOuList" style="overflow:hidden;">
										<div class="box-header with-border padding10 clearfix">
											<h3 class="box-title">组织机构</h3>
										</div>

										<div class="box-body">
											<div class="form-group has-feedback">
												<input type="text" id="ztreeOuKey" class="form-control serach-ulMenu" placeholder="请输入名称按回车键进行查找">
												<span class="idpicon i-search-bold form-control-feedback"></span>
											</div>
											<p class="removeOu_box clearfix">
												<a class="btn btn-danger btn-xs" id="batchRemoveOu">批量删除</a>
											</p>
											<div class="ztree-box clearfix">
												

<div class="content_wrap">
	<div class="zTreeDemoBackground left">
		<ul id="treeDemo" class="ztree"></ul>
	</div>
	<!--<div class="right">
		<ul class="info">
			<li class="title">
				
				<ul class="list">
				
				<li>
					<p>搜索试试看：<br/>
						关键字：<input type="text" id="key" value="" class="empty" /><br/>
					</p>
				</li>
				</ul>
			</li>
			
		</ul>
	</div>-->
</div>
											</div>
										</div>
									</div>

									<!--/ 组织目录树右键菜单 -->
									<div id="rMenu">
										<ul>
											<li class="menu-oper-add" id="mAdd">新增
												<ul class="menu">
													<li id="addOULi">单位或部门</li>
													<li id="addGroupLi">岗位组</li>
													<li id="addAccountLi">账户</li>
												</ul>
											</li>
											<li class="menu-oper-import" id="mImport" data-toggle="modal" data-backdrop="false">导入</li>
											<li class="menu-oper-del" id="mDel" data-toggle="modal" data-backdrop="false">删除</li>
											<li class="menu-oper-move" id="mMove" data-toggle="modal" data-backdrop="false">移动</li>
											<li class="menu-oper-edit" id="mEdit">属性</li>
										</ul>
									</div>

									<div class="modal fade bs-example-modal" id="addOUModal" tabindex="-1" role="dialog" data-backdrop="false" aria-labelledby="addOUModalLabel">
										<div class="modal-dialog modal-lg" role="document">
											<div class="modal-content">
												<div class="modal-header">
													<button id="closeBtn3" type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
													<h4 class="modal-title" id="addOUModalLabel"></h4>
												</div>
												<div class="modal-body">
													<div id="addOUModalBody">
													</div>
												</div>
												<div class="modal-footer">
													<span id="addOUModalMsg"></span>&nbsp;
													<button type="button" class="btn btn-primary" id="addOUModalSubmit">添加</button>
													<button type="button" class="btn btn-default" data-dismiss="modal" id="closeBtn">关闭</button>
												</div>
											</div>
										</div>
									</div>

									<div class="modal fade" tabindex="-1" role="dialog" id="scimResultModel">
										<div class="modal-dialog" style="width: 400px;" role="document">
											<div class="modal-content">
												<div class="modal-header">
													<h4 class="modal-title">系统提示</h4>
												</div>
												<div class="modal-body" style="padding:15px 30px">

													<div class="modal-con-box" style="margin-bottom: 15px">
														<p>此次同步删除组织机构成功<span class='label-success padding3' id='organSuccessCount'></span> 个,失败<span class='label-warning padding3' id='organFailedCount'></span> 个</p>
														<p><button class="btn btn-primary" onclick="window.location='/enterprise/ud/ad/batch/organ/scim/record/2d9ccc8515286b8f14f6cb4d6faad6ebptu9ceiUpAK'">查看详情</button></p>
													</div>
												</div>
												<div class="modal-footer">
													<button type="button" class="btn btn-primary" onclick="window.location='/enterprise/ud/ad/list_all'">知道了</button>
												</div>
											</div>
											<!-- /.modal-content -->
										</div>
										<!-- /.modal-dialog -->
									</div>
									<!-- /.modal -->

									<div class="modal fade" tabindex="-1" role="dialog" id="scimDeleteOUMemberResultModel">
										<div class="modal-dialog" style="width: 400px;" role="document">
											<div class="modal-content">
												<div class="modal-header">
													<h4 class="modal-title">系统提示</h4>
												</div>
												<div class="modal-body" style="padding:15px 30px">

													<div class="modal-con-box" style="margin-bottom: 15px">
														<span id="deleteMsg"></span>
													</div>
												</div>
												<div class="modal-footer">
													<button type="button" class="btn btn-primary" onclick="window.location='/enterprise/ud/ad/list_all'">知道了</button>
												</div>
											</div>
											<!-- /.modal-content -->
										</div>
										<!-- /.modal-dialog -->
									</div>
									<!-- /.modal -->

									<div class="modal fade" tabindex="-1" role="dialog" id="scimMoveResultModel">
										<div class="modal-dialog" style="width: 400px;" role="document">
											<div class="modal-content">
												<div class="modal-header">
													<h4 class="modal-title">系统提示</h4>
												</div>
												<div class="modal-body" style="padding:15px 30px">

													<div class="modal-con-box" style="margin-bottom: 15px">
														<p>移动成功,并同步移动组织机构成功<span class="label-success padding3" id="organMoveSuccessCount"></span> 个,失败<span class="label-warning padding3" id="organMoveFailedCount"></span> 个</p>
														<p><button class="btn btn-primary" onclick="window.location='/enterprise/ud/ad/batch/organ/scim/record/2d9ccc8515286b8f14f6cb4d6faad6ebptu9ceiUpAK'">查看详情</button></p>
													</div>
												</div>
												<div class="modal-footer">
													<button type="button" class="btn btn-primary" onclick="window.location='/enterprise/ud/ad/list_all'">知道了</button>
												</div>
											</div>
											<!-- /.modal-content -->
										</div>
										<!-- /.modal-dialog -->
									</div>
									<!-- /.modal -->

									<div class="modal fade" tabindex="-1" role="dialog" id="scimChildrensModel">
										<div class="modal-dialog" style="width: 400px;" role="document">
											<div class="modal-content">
												<div class="modal-header">
													<h4 class="modal-title">系统提示</h4>
												</div>
												<div class="modal-body" style="padding:15px 30px" id="scimChildrensBody">
													<form id="scimChildrensModalForm" method="post">
														<div class="" style="margin-bottom: 15px">
															<i class="fa fa-3x fa-check-circle" style="color: #3C763D"></i> <span id="scimHandleMsg" style="font-size: 18px;position: relative;top: -8px;padding-left: 8px">操作成员成功</span>
														</div>
														<input type="hidden" name="uuid">
														<tags:csrf/>
														<div class="modal-con-box">
															<p style="margin: 0">是否需要将成员信息同步至已授权应用？</p>

															<p style="font-size:12px;"><span style="color:#FFA743;">（勾选后系统会将数据同步至所选应用系统）</span></p>

															<div id="appListDiv" class="modal-content-applist"></div>
														</div>
													</form>
												</div>
												<div class="modal-footer">
													<button type="button" class="btn btn-primary" id="scimChildrensModalSubmit">确认同步</button>
													<button type="button" class="btn btn-default" id="scimChildrensModelCancel" data-dismiss="modal">取消</button>
												</div>
											</div>
											<!-- /.modal-content -->
										</div>
										<!-- /.modal-dialog -->
									</div>

									<!-- /.modal -->
									<!--!同步结果显示-->
									<div class="modal fade" tabindex="-1" role="dialog" id="adScimResultModel">
										<div class="modal-dialog" style="width: 400px;" role="document">
											<div class="modal-content">
												<div class="modal-header">
													<h4 class="modal-title">系统提示</h4>
												</div>
												<div class="modal-body" style="padding:15px 30px">

													<div class="modal-con-box">
														<p>
															此次同步,成功<span class="label-success padding3" id='successCount'></span> 个,失败<span class="label-warning padding3" id='failedCount'></span> 个
														</p>
														<input type="hidden" name="scimuuid" id="scimuuid" />

													</div>
												</div>
												<div class="modal-footer">
													<button type="button" class="btn btn-primary ScimResultModelCancel">知道了</button>
												</div>
											</div>
											<!-- /.modal-content -->
										</div>
										<!-- /.modal-dialog -->
									</div>
									<!-- /.modal -->

									<div class="modal fade" tabindex="-1" role="dialog" id="exportOperate">
										<div class="modal-dialog" style="width: 400px;" role="document">
											<div class="modal-content">
												<form id="exportOperateModalForm" method="get" action="/enterprise/ud/ad/operate/export_submit">
													<div class="modal-header">
														<h4 class="modal-title">系统提示</h4>
													</div>
													<div class="modal-body" style="padding:15px 30px" id="exportOperateBody">

														<div class="" style="margin-bottom: 15px">
															<i class="fa fa-3x fa-check-circle" style="color: #3C763D"></i> <span id="exportHandleMsg" style="font-size: 18px;position: relative;top: -8px;padding-left: 8px">请选择要导出的变更动作范围</span>
														</div>
														<input type="hidden" name="ouUuid">
														<tags:csrf/>
														<div class="modal-con-box">

															<label class="disabled" style="margin-top:10px;margin-right: 7px; ">
                            <span  style="width:200px;"><input disabled type="checkbox" name="exportOu" style="vertical-align:top;"  checked="checked" /> 组织机构</span>
                            <input  type="checkbox" name="exportOu" hidden="hidden" checked="checked" />
                        </label>
															<label style="margin-top:10px;margin-right:7px;">
                           <span  style="width:100px"><input type="checkbox" name="exportGroup" style="vertical-align:top;"  checked="checked"/> 组</span>
                       </label>
															<label style="margin-top:10px;margin-right: 7px;">
                           <span  style="width:100px"><input type="checkbox" name="exportAccount" style="vertical-align:top;"  checked="checked"/> 账户</span>
                       </label>
															<div><input type="radio" style="margin-right:3px;" name="exportAll" value="false" checked>上次导出到现在的所有变更</div>
															<div style="padding-left: 15px;margin-bottom:0;" class="help-block">上次导出时间：<span id='lastExportTime'></span></div>
															<div><input type="radio" name="exportAll" value="true" style="margin-right:3px;">导出全部</div>

														</div>
													</div>
													<div class="modal-footer">
														<button type="submit" class="btn btn-primary" id="exportOperateModalSubmit">导出</button>
														<button type="button" class="btn btn-default" id="exportOperateModelCancel" data-dismiss="modal">取消</button>
													</div>
												</form>
											</div>
											<!-- /.modal-content -->
										</div>
										<!-- /.modal-dialog -->
									</div>

									<div class="modal fade bs-example-modal" id="ldapConfigModal" tabindex="-1" role="dialog" data-backdrop="false" aria-labelledby="ldapConfigModalLabel">
										<div class="modal-dialog" role="document">
											<div class="modal-content">
												<div class="modal-header">
													<button id="ldapConfigCloseBtn" type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
													<h4 class="modal-title" id="ldapConfigLabel"></h4>
												</div>
												<div class="modal-body">
													<div id="ldapConfigModalBody">
													</div>
												</div>
												<div class="modal-footer">
													<span id="ldapConfigModalMsg"></span>&nbsp;
													<button type="button" class="btn btn-primary" id="ldapConfigModalSubmit">保存</button>
													<button type="button" class="btn btn-default" data-dismiss="modal" id="ldapConfigCancelBtn">取消</button>
												</div>
											</div>
										</div>
									</div>

									<div class="modal fade bs-example-modal" id="ldapPullModal" tabindex="-1" role="dialog" data-backdrop="false" aria-labelledby="ldapPullModalLabel">
										<div class="modal-dialog modal-sm" role="document">
											<div class="modal-content">
												<div class="modal-header">
													<button id="ldapPullCloseBtn" type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
													<h4 class="modal-title" id="ldapPullLabel">
                    导入LDAP数据</h4>
												</div>
												<div class="modal-body">
													<div id="ldapPullModalBody">
														<div class="modal-con-box" id="accountResultDiv">
															<p>
																此次导入LDAP账户
																<span class='label-success padding3' id='successLDAPCount'></span> 个
															</p>

														</div>

														<div class="modal-con-box" id="ouResultDiv">
															<p>
																此次导入LDAP 组织机构
																<span class='label-success padding3' id='successLDAPOUCount'></span> 个
															</p>

														</div>
													</div>
												</div>
												<div class="modal-footer">
													<span id="ldapPullModalMsg"></span>&nbsp;
													<button type="button" class="btn btn-primary" id="ldapPullModalSubmit" onclick="location.reload();">确定</button>
													<button type="button" class="btn btn-default" data-dismiss="modal" onclick="location.reload();" id="ldapPullCancelBtn">关闭</button>
												</div>
											</div>
										</div>
									</div>

				
				
								</div>
								<!-- /.col -->
								<div class="col-md-9">
									<div class="box box-border-top min-height350 loader-parent">

										<div class="box-header with-border padding10 clearfix" style="padding-bottom: 0;z-index:2;">
											<h3 class="box-title table-header">

                        </h3>

											

											
											<!-- account change : move or created or delete -->
											

										</div>
										<div class="parent_box">
											<!-- /.box-header  list_all-->
											<div class="box-body no-padding list_box list_all_box">
												<div class="mailbox-messages padding10 displayTarget box-table-limith">
													<div class="table-responsive box-table-userall" style="min-height:500px;">
														<div class="clearfix ud_tool_box">
															<ul class="nav nav-tabs" role="tablist" id="rootNodeNav">
																<li role="presentation" class="active">
																	<a href="#accountList" aria-controls="accountList" udType="account" role="tab" data-toggle="tab">账户</a>
																</li>
																<li role="presentation">
																	<a href="#groupList" aria-controls="groupList" udType="group" role="tab" data-toggle="tab">组</a>
																</li>
																
															</ul>
															<div class="box-tools pull-right ud_tools" style="width: 57%;">
																
																<!--<a class="btn btn-info btn-right btn-sm addUDGroup" id="addUDGroup">
																	<em class="fa fa-plus"></em> 新建岗位组
																</a>-->
																<a class="btn btn-success btn-right btn-sm addUDAccount" id="addUDAccount">
																	<em class="fa fa-plus"></em> 新建账户
																</a>

															</div>
														</div>

														<div class="tab-content" style="position: relative">
															<a class="sort-account btn btn-primary btn-left"><i class="idpicon i-das"></i> 账户排序</a>
															<span class="title"><i class="idpicon i-data-total icon-primary"></i><b  class="list-all-title"></b></span>
															
															<div role="tabpanel" class="tab-pane active" id="accountList">
																<table class="table table-bordered" id="tableUserAll">
																	<thead>
																		<tr>
																			
																			<th width="50">编号</th>
																			<th class="table-ud-all-name">所属组织</th>
																			<th class="table-ud-all-name">账号</th>
																			<th class="table-ud-type">用户姓名</th>
																			<th class="table-ud-type">用户状态</th>
																			<th class="table-ud-action min-w110">操作</th>
																		</tr>
																	</thead>
																	<tbody class="zhanghutb">
																		
																	</tbody>
																</table>
															</div>
															<div role="tabpanel" class="tab-pane" id="groupList">
																<table class="table table-bordered" id="AllGroupListTable">
																	<thead>
																		<tr>
																			<th class="table-ud-all-name">名称</th>
																			<th class="table-ud-type">类型</th>
																			<th class="table-ud-description">描述</th>
																			<th class="table-ud-action min-w110">操作</th>
																		</tr>
																	</thead>
																</table>
															</div>
														</div>

													</div>
												</div>
											</div>
											<!-- /.box-header  list_Ou-->
											
										</div>

									</div>

								</div>
							</div>
						</div>
					</div>

					
					
					

					
					
					<!-- /.modal -->
					<script src="/static/js/ud/enterprise_ud.table.js?v=2.15.7"></script>
					<script src="/static/plugins/ajaxTable/ud_ajax_table.js?v=2.15.7"></script>

					<div id="ie-footer"></div>
				</div>
			</div>
			<!-- /.content -->
		</div>

		<!--新增-->
		<div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="entModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="entModalLabel"></h4>
					</div>
					<div class="modal-body">
						<table class="table table-striped table-hover">
						</table>
					</div>
					<div class="modal-footer">
						<span id="modalMsg"></span>&nbsp;
						<button type="button" class="btn btn-primary" id="addyonghu">提交</button>
						<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
					</div>
				</div>
			</div>
		</div>
		
		<!--编辑-->
		<div class="modal fade" id="bjModal" tabindex="-1" role="dialog" aria-labelledby="entModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="entModalLabel"></h4>
					</div>
					<div class="modal-body">
						<table class="table table-striped table-hover">
						</table>
					</div>
					<div class="modal-footer">
						<span id="modalMsg"></span>&nbsp;
						<button type="button" class="btn btn-primary" id="bjyonghu">提交</button>
						<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
					</div>
				</div>
			</div>
		</div>
		 
			

		<!--[if lt IE 9]>
<script src="/static/ie8/ie.js"></script>
<![endif]-->
	</body>
	<script src="static/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/servise.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		$.ajax({
				type:"get",
				url:servise+"/organization",
				async:true,
				success:function(data){
						var dataall = [] ;
						dataall = data;
						console.log(dataall)
						var setting = {
								check: {
									enable: true//checkbox
								},
								view: {
									nameIsHTML: true, //允许name支持html				
									selectedMulti: false
								},
								edit: {
									enable: false,
									editNameSelectAll: false
								},
								data: {
									simpleData: {
										enable: true
									},
									key: {
													name: "orgName",
													children: "orgList",
													title: "code"
												}
								},
								callback: {
									
									onClick: onClick
								}
						};
						
						
						function onClick(event, treeId, treeNode, clickFlag) {
							console.log(treeNode.code);
							$.ajax({
								type:"get",
								url:servise+"/users",
								data:{code:treeNode.code,pageSize:10,pageNo:1},
								async:true,
								success:function(data){
									console.log(data)
									var str = '';
									
									for(i=0;i<data.length;i++){
										str+='<tr><td>'+data[i].id+'</td><td>'+data[i].orgid+'</td><td>'+data[i].cjid+'</td><td>'+data[i].username+'</td><td>'+data[i].userStatus+'</td><td><a id="'+data[i].id+'" class="btn btn-sm btn-default app-dtl-targ bjzu">编辑</a></td></tr>'
									}
									$(".zhanghutb").html(str)
								}
							});
						}		
						
						$.fn.zTree.init($("#treeDemo"), setting, dataall);
						fuzzySearch('treeDemo','#ztreeOuKey',null,true); //初始化模糊搜索方法
				}
			});
			var idbj = '';
			$(".zhanghutb").on("click",".bjzu",function(){
				idbj = $(this).attr("id")
				$("#bjModal").modal('show')
				$.ajax({
					type:"get",
					url:servise+"/users/"+$(this).attr("id"),
//					data:{},
					async:true,
					success:function(data){
						console.log(data)
						$("#bjModal table").html('<tbody><tr><td>所属组织</td><td><input class="form-control" value="'+data.orgid+'"/></td></tr><tr><td>账号</td><td><input class="form-control" disabled value="'+data.cjid+'"/></td></tr><tr><td>用户姓名</td><td><input class="form-control" value="'+data.username+'"/></td></tr><tr><td>用户密码</td><td><input class="form-control" value="'+data.password+'"/></td></tr><tr><td>手机号</td><td><input class="form-control" value="'+data.mobile+'"/></td></tr><tr><td>电子邮箱</td><td><input class="form-control" value="'+data.email+'"/></td></tr><tr><td>用户状态</td><td><input class="form-control" value="'+data.userStatus+'"/></td></tr></tbody>')
					}
				});
			})
			$("#bjyonghu").click(function(){
				var bjarr = [];
				$(".form-control").each(function() {
					bjarr.push($(this).val())
				})
				console.log(bjarr)
				$.ajax({
					type:"post",
					url:servise+"/users/"+idbj,
					data:{
						orgid:bjarr[1],
						cjid:bjarr[2],
						username:bjarr[3],
						password:bjarr[4],
						mobile:bjarr[5],
						email:bjarr[6],
						userStatus:bjarr[7]
					},
					async:true,
					success:function(){
						$("#bjModal").modal('hide')
					}
				});
				
			})
			$("#addUDAccount").click(function(){
				$("#addModal").modal('show')
				$("#addModal table").html('<tbody><tr><td>所属组织</td><td><input class="form-control" value=""/></td></tr><tr><td>账号</td><td><input class="form-control" value=""/></td></tr><tr><td>用户姓名</td><td><input class="form-control" value=""/></td></tr><tr><td>用户密码</td><td><input class="form-control" value=""/></td></tr><tr><td>手机号</td><td><input class="form-control" value=""/></td></tr><tr><td>电子邮箱</td><td><input class="form-control" value=""/></td></tr><tr><td>用户状态</td><td><input class="form-control" value=""/></td></tr></tbody>')
				$("#addyonghu").click(function(){
					var addarr = [];
					$(".form-control").each(function() {
						addarr.push($(this).val())
					})
					console.log(addarr)
					$.ajax({
						type:"post",
						url:servise+"/users",
						data:{
							orgid:addarr[1],
							cjid:addarr[2],
							username:addarr[3],
							password:addarr[4],
							mobile:addarr[5],
							email:addarr[6],
							userStatus:addarr[7]
						},
						async:true,
						success:function(){
							$("#addModal").modal('hide')
						}
					});	
				})
				
			})
	</script>
</html>